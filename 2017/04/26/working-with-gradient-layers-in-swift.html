<!DOCTYPE html>
<html class="no-js">
  <head>
	<meta charset="utf-8">
	<title>Animated gradient layers in Swift | Implement</title>
	<meta name="description" content="IntroductionIn this blog post we will look at how to use the CAGradientLayer API and create some cool animated gradient effects like the ones seen inapps lik...">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-Frame-Options" content="sameorigin">
	
	<!-- CSS -->
	<link rel="stylesheet" href="/css/main.css">
	
	<!--Favicon-->
	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
	
	<!-- Canonical -->
	<link rel="canonical" href="https://oktapodi.github.io/2017/04/26/working-with-gradient-layers-in-swift.html">
	
	<!-- RSS -->
	<link rel="alternate" type="application/atom+xml" title="Implement" href="https://oktapodi.github.io/feed.xml" />
	
	<!-- Font Awesome -->
	<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
	
	<!-- Google Fonts -->
	
	<link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,700italic,400italic" rel="stylesheet" type="text/css">
	
	
	<!-- KaTeX -->
	
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.3.0/katex.min.css">
	<script src="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.3.0/katex.min.js"></script>
	
	
	<!-- Google Analytics -->
	
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
		
		ga('create', 'UA-98096444-1', 'auto');
		ga('send', 'pageview');
	</script>
	
	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({
			google_ad_client: "ca-pub-4107295384129771",
			enable_page_level_ads: true
		});
	</script>
</head>

  <body>
    <header class="site-header">
	<div class="branding">
		
		<a href="/">
			<img class="avatar" src="/img/avatar.png" alt=""/>
		</a>
		
		<h1 class="site-title">
			<a href="/">Implement</a>
		</h1>
	</div>
	<nav class="site-nav">
		<ul>
			
			
			
			
			<li>
				<a class="page-link" href="/about/">
					About
				</a>
			</li>
			
			
			
			
			
			
			
			
			<!-- Social icons from Font Awesome, if enabled -->
			


<li>
	<a href="mailto:prabhu.saitu@gmail.com" title="Email">
		<i class="fa fa-fw fa-envelope"></i>
	</a>
</li>









<li>
	<a href="https://www.facebook.com/prabhu" title="Follow on Facebook">
		<i class="fa fa-fw fa-facebook"></i>
	</a>
</li>





<li>
	<a href="https://github.com/oktapodi" title="Follow on GitHub">
		<i class="fa fa-fw fa-github"></i>
	</a>
</li>





<li>
	<a href="http://instagram.com/prabhu.jpg" title="Follow on Instagram">
		<i class="fa fa-fw fa-instagram"></i>
	</a>
</li>

















<li>
	<a href="https://twitter.com/prabhu_irl" title="Follow on Twitter">
		<i class="fa fa-fw fa-twitter"></i>
	</a>
</li>






		</ul>
	</nav>
</header>

    <div class="content">
      <article >
  <header style="background-image: url('/')">
    <h1 class="title">Animated gradient layers in Swift</h1>
    <p class="meta">
    April 26, 2017
    
    </p>
  </header>
  <section class="post-content"><h3 id="introduction">Introduction</h3>
<p>In this blog post we will look at how to use the CAGradientLayer API and create some cool animated gradient effects like the ones seen in
apps like instagram.</p>

<h3 id="cagradientlayer">CAGradientLayer</h3>

<p>The CAGradientLayer is a CALayer that allows us to draw gradients. It can accept any number of colors as input and blend those colors
together to render a continuous gradient of colors.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">// A Basic Implementation</span>
<span class="k">let</span> <span class="nv">gradient</span> <span class="o">=</span> <span class="kt">CAGradientLayer</span><span class="p">()</span>
<span class="n">gradient</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">bounds</span>
<span class="n">gradient</span><span class="o">.</span><span class="n">colors</span> <span class="o">=</span> <span class="p">[</span>
    <span class="kt">UIColor</span><span class="p">(</span><span class="nv">red</span><span class="p">:</span> <span class="mi">48</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="nv">green</span><span class="p">:</span> <span class="mi">62</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="nv">blue</span><span class="p">:</span> <span class="mi">103</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="nv">alpha</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cgColor</span><span class="p">,</span>
    <span class="kt">UIColor</span><span class="p">(</span><span class="nv">red</span><span class="p">:</span> <span class="mi">244</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="nv">green</span><span class="p">:</span> <span class="mi">88</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="nv">blue</span><span class="p">:</span> <span class="mi">53</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="nv">alpha</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cgColor</span>
<span class="p">]</span>
<span class="n">gradient</span><span class="o">.</span><span class="n">startPoint</span> <span class="o">=</span> <span class="kt">CGPoint</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span><span class="mi">0</span><span class="p">)</span>
<span class="n">gradient</span><span class="o">.</span><span class="n">endPoint</span> <span class="o">=</span> <span class="kt">CGPoint</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span>
<span class="k">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">layer</span><span class="o">.</span><span class="nf">addSublayer</span><span class="p">(</span><span class="n">gradient</span><span class="p">)</span></code></pre></figure>

<p>The code above creates a diagonal gradient between two colors. The direction of the gradient can be controlled by the adjusting the
start and end points of the gradient.</p>

<p><img src="/img/gradient01.png" alt="Gradient" /></p>

<h3 id="animating-gradients">Animating Gradients</h3>

<p>Since all CALayer proporties are animatable we can create a CABasicAnimation on the colors property of the CAGradientLayer to show a smooth
transition from one gradient to another.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">let</span> <span class="nv">gradientChangeAnimation</span> <span class="o">=</span> <span class="kt">CABasicAnimation</span><span class="p">(</span><span class="nv">keyPath</span><span class="p">:</span> <span class="s">"colors"</span><span class="p">)</span>
<span class="n">gradientChangeAnimation</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="mf">5.0</span>
<span class="n">gradientChangeAnimation</span><span class="o">.</span><span class="n">toValue</span> <span class="o">=</span> <span class="p">[</span>
    <span class="kt">UIColor</span><span class="p">(</span><span class="nv">red</span><span class="p">:</span> <span class="mi">244</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="nv">green</span><span class="p">:</span> <span class="mi">88</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="nv">blue</span><span class="p">:</span> <span class="mi">53</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="nv">alpha</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cgColor</span><span class="p">,</span>
    <span class="kt">UIColor</span><span class="p">(</span><span class="nv">red</span><span class="p">:</span> <span class="mi">196</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="nv">green</span><span class="p">:</span> <span class="mi">70</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="nv">blue</span><span class="p">:</span> <span class="mi">107</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="nv">alpha</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cgColor</span>
    <span class="p">]</span>
<span class="n">gradientChangeAnimation</span><span class="o">.</span><span class="n">fillMode</span> <span class="o">=</span> <span class="n">kCAFillModeForwards</span>
<span class="n">gradientChangeAnimation</span><span class="o">.</span><span class="n">isRemovedOnCompletion</span> <span class="o">=</span> <span class="kc">false</span>
<span class="n">gradient</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="n">gradientChangeAnimation</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="s">"colorChange"</span><span class="p">)</span></code></pre></figure>

<p>The code above changes the animates the gradient over a duration of 5 seconds.</p>

<iframe src="https://player.vimeo.com/video/214767743" width="640" height="360" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe>

<h3 id="continuous-animations">Continuous Animations</h3>

<p>We can expand on this approach and create a continuous looping animation where one gradient seamlessly blends into another over time. To implment
a continuous gradient we must extend our view controller to conform to the <strong>CAAnimationDelegate</strong> protocol. An example of such an implementation 
is shown here.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">class</span> <span class="kt">ViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>
    
    <span class="k">let</span> <span class="nv">gradient</span> <span class="o">=</span> <span class="kt">CAGradientLayer</span><span class="p">()</span>
    <span class="k">var</span> <span class="nv">gradientSet</span> <span class="o">=</span> <span class="p">[[</span><span class="kt">CGColor</span><span class="p">]]()</span>
    <span class="k">var</span> <span class="nv">currentGradient</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="k">let</span> <span class="nv">gradientOne</span> <span class="o">=</span> <span class="kt">UIColor</span><span class="p">(</span><span class="nv">red</span><span class="p">:</span> <span class="mi">48</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="nv">green</span><span class="p">:</span> <span class="mi">62</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="nv">blue</span><span class="p">:</span> <span class="mi">103</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="nv">alpha</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cgColor</span>
    <span class="k">let</span> <span class="nv">gradientTwo</span> <span class="o">=</span> <span class="kt">UIColor</span><span class="p">(</span><span class="nv">red</span><span class="p">:</span> <span class="mi">244</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="nv">green</span><span class="p">:</span> <span class="mi">88</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="nv">blue</span><span class="p">:</span> <span class="mi">53</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="nv">alpha</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cgColor</span>
    <span class="k">let</span> <span class="nv">gradientThree</span> <span class="o">=</span> <span class="kt">UIColor</span><span class="p">(</span><span class="nv">red</span><span class="p">:</span> <span class="mi">196</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="nv">green</span><span class="p">:</span> <span class="mi">70</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="nv">blue</span><span class="p">:</span> <span class="mi">107</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="nv">alpha</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cgColor</span>
    
    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>
        <span class="c1">// Do any additional setup after loading the view, typically from a nib.</span>
    <span class="p">}</span>
    
    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidAppear</span><span class="p">(</span><span class="n">_</span> <span class="nv">animated</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidAppear</span><span class="p">(</span><span class="n">animated</span><span class="p">)</span>
        
        <span class="n">gradientSet</span><span class="o">.</span><span class="nf">append</span><span class="p">([</span><span class="n">gradientOne</span><span class="p">,</span> <span class="n">gradientTwo</span><span class="p">])</span>
        <span class="n">gradientSet</span><span class="o">.</span><span class="nf">append</span><span class="p">([</span><span class="n">gradientTwo</span><span class="p">,</span> <span class="n">gradientThree</span><span class="p">])</span>
        <span class="n">gradientSet</span><span class="o">.</span><span class="nf">append</span><span class="p">([</span><span class="n">gradientThree</span><span class="p">,</span> <span class="n">gradientOne</span><span class="p">])</span>
        
        
        <span class="n">gradient</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">bounds</span>
        <span class="n">gradient</span><span class="o">.</span><span class="n">colors</span> <span class="o">=</span> <span class="n">gradientSet</span><span class="p">[</span><span class="n">currentGradient</span><span class="p">]</span>
        <span class="n">gradient</span><span class="o">.</span><span class="n">startPoint</span> <span class="o">=</span> <span class="kt">CGPoint</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">gradient</span><span class="o">.</span><span class="n">endPoint</span> <span class="o">=</span> <span class="kt">CGPoint</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">gradient</span><span class="o">.</span><span class="n">drawsAsynchronously</span> <span class="o">=</span> <span class="kc">true</span>
        <span class="k">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">layer</span><span class="o">.</span><span class="nf">addSublayer</span><span class="p">(</span><span class="n">gradient</span><span class="p">)</span>
        
        <span class="nf">animateGradient</span><span class="p">()</span>
        
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">animateGradient</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">currentGradient</span> <span class="o">&lt;</span> <span class="n">gradientSet</span><span class="o">.</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">{</span>
            <span class="n">currentGradient</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">currentGradient</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="p">}</span>
        
        <span class="k">let</span> <span class="nv">gradientChangeAnimation</span> <span class="o">=</span> <span class="kt">CABasicAnimation</span><span class="p">(</span><span class="nv">keyPath</span><span class="p">:</span> <span class="s">"colors"</span><span class="p">)</span>
        <span class="n">gradientChangeAnimation</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="mf">5.0</span>
        <span class="n">gradientChangeAnimation</span><span class="o">.</span><span class="n">toValue</span> <span class="o">=</span> <span class="n">gradientSet</span><span class="p">[</span><span class="n">currentGradient</span><span class="p">]</span>
        <span class="n">gradientChangeAnimation</span><span class="o">.</span><span class="n">fillMode</span> <span class="o">=</span> <span class="n">kCAFillModeForwards</span>
        <span class="n">gradientChangeAnimation</span><span class="o">.</span><span class="n">isRemovedOnCompletion</span> <span class="o">=</span> <span class="kc">false</span>
        <span class="n">gradient</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="n">gradientChangeAnimation</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="s">"colorChange"</span><span class="p">)</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">ViewController</span><span class="p">:</span> <span class="kt">CAAnimationDelegate</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">animationDidStop</span><span class="p">(</span><span class="n">_</span> <span class="nv">anim</span><span class="p">:</span> <span class="kt">CAAnimation</span><span class="p">,</span> <span class="n">finished</span> <span class="nv">flag</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">flag</span> <span class="p">{</span>
            <span class="n">gradient</span><span class="o">.</span><span class="n">colors</span> <span class="o">=</span> <span class="n">gradientSet</span><span class="p">[</span><span class="n">currentGradient</span><span class="p">]</span>
            <span class="nf">animateGradient</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>In the code above we start off by creating 3 different gradients. We the append them in an array called <strong>gradientSet</strong>, out animation will loop through the array and blend one gradient into another. We keep a simple index <strong>currentGradient</strong> to keep track of which gradient is to be displayed and change the <strong>toValue</strong> of our <strong>gradientAnimation</strong> to that particular gradient. Since weâ€™re going to be rerendering our gradientlayer we set the <strong>drawAsynchronously</strong> flag to true.</p>

<iframe src="https://player.vimeo.com/video/214767743" width="640" height="360" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe>

<h3 id="conclusion">Conclusion</h3>

<p>CAGradientLayer is a powerful API and can be used in conjuntion with other CALayer APIs provided by iOS to create some really cool effects in a very simple
concise manner.</p>
</section>
</article>

<!-- Post navigation -->


<!-- Begin MailChimp Signup Form -->
<link href="//cdn-images.mailchimp.com/embedcode/classic-10_7.css" rel="stylesheet" type="text/css">
<style type="text/css">
	#mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; }
	/* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
	   We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
<div id="mc_embed_signup">
<form action="//github.us15.list-manage.com/subscribe/post?u=9b45e11b10e51e2e786dcad04&amp;id=2221bf0e2c" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
	<h2>Subscribe to our mailing list</h2>
<div class="indicates-required"><span class="asterisk">*</span> indicates required</div>
<div class="mc-field-group">
	<label for="mce-EMAIL">Email Address  <span class="asterisk">*</span>
</label>
	<input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL">
</div>
<div class="mc-field-group">
	<label for="mce-FNAME">First Name </label>
	<input type="text" value="" name="FNAME" class="" id="mce-FNAME">
</div>
<div class="mc-field-group">
	<label for="mce-LNAME">Last Name </label>
	<input type="text" value="" name="LNAME" class="" id="mce-LNAME">
</div>
	<div id="mce-responses" class="clear">
		<div class="response" id="mce-error-response" style="display:none"></div>
		<div class="response" id="mce-success-response" style="display:none"></div>
	</div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_9b45e11b10e51e2e786dcad04_2221bf0e2c" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
</form>
</div>

<!--End mc_embed_signup-->

<!-- Disqus -->


<!-- Muut -->



    </div>
    
<script src="/js/katex_init.js"></script>



<footer class="site-footer">
	<p class="text">Powered by <a href="http://jekyllrb.com">Jekyll</a> with <a href="https://rohanchandra.github.io/project/type/">Type Theme</a>
</p>
</footer>


  </body>
</html>
